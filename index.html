<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>進制轉換器｜Base Converter (2–62)</title>
  <style>
    :root { --bg:#0b1020; --panel:#111726; --muted:#9fb4d7; --text:#eef3fb; --error:#ff6b6b; }
    * { box-sizing: border-box; }
    body { margin:0; font-family: ui-sans-serif, -apple-system, Segoe UI, Roboto, Noto Sans, Arial; background: var(--bg); color: var(--text); }
    .wrap { max-width: 760px; margin: 40px auto; padding: 0 16px; }
    h1 { font-size: 26px; margin: 0 0 14px; }
    .card { background: var(--panel); border:1px solid rgba(124,193,255,.25); border-radius: 14px; padding: 16px; }
    label { display:block; font-weight:600; margin-bottom:8px; }
    input[type="text"], input[type="number"] {
      width: 100%; padding: 11px 12px; border-radius: 10px;
      background:#0e1526; border:1px solid rgba(124,193,255,.35); color: var(--text); font-size: 15px;
    }
    input::placeholder { color:#a9bddf; }
    .row { display:grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    .muted { color: var(--muted); font-size: 13px; margin-top:6px; }
    .alert { color: var(--error); min-height: 1.2em; margin-top: 8px; }
    .result { margin-top: 14px; }
    .caption { font-size: 13px; color: var(--muted); margin-bottom: 6px; }
    .out { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; background:#0e1526; border:1px solid rgba(124,193,255,.35); border-radius: 10px; padding: 11px 12px; word-break: break-all; }
  </style>
</head>
<body>
  <main class="wrap">
    <h1>進制轉換器（2–62）</h1>
    <section class="card">
      <label for="val">數值（x 進位）</label>
      <input id="val" type="text" placeholder="例：1a7_f0 或 101101">
      <div class="muted">允許字元：0-9 a-z A-Z；可使用 <code>+</code>/<code>-</code> 與底線 <code>_</code> 分隔（不影響數值）。</div>
      <div class="row" style="margin-top:10px;">
        <div>
          <label for="from">x（來源進位）</label>
          <input id="from" type="number" min="2" max="62" value="16">
        </div>
        <div>
          <label for="to">y（目標進位）</label>
          <input id="to" type="number" min="2" max="62" value="2">
        </div>
      </div>
      <div id="alert" class="alert" aria-live="polite"></div>
      <div class="result">
        <div class="caption">轉換結果</div>
        <div id="out" class="out">（輸入後即時顯示）</div>
      </div>
    </section>
  </main>
  <script>
    (function(){
      "use strict";
      const DIGITS = "0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";
      const charToVal = new Map([...DIGITS].map((c,i)=>[c,i]));
      const $ = (id)=>document.getElementById(id);
      const $val = $("val"), $from = $("from"), $to = $("to"), $out = $("out"), $alert = $("alert");

      function sanitize(s){ return s.trim().replace(/\s+/g,"").replace(/_/g,""); }
      function validateDigits(s, base){
        for(let i=0;i<s.length;i++){
          const ch = s[i];
          if(!charToVal.has(ch)) return {ok:false, msg:`不支援的字元「${ch}」`};
          const v = charToVal.get(ch);
          if(v >= base) return {ok:false, msg:`字元「${ch}」超過基數 ${base} 的範圍`};
        }
        return {ok:true};
      }
      function parseToBigInt(raw, base){
        if(!(base>=2 && base<=62)) throw new Error("基數必須介於 2 到 62");
        if(!raw) throw new Error("請輸入數值");
        let sign = 1n;
        let s = raw;
        if(s[0]==="+") s = s.slice(1);
        else if(s[0]==="-"){ sign = -1n; s = s.slice(1); }
        s = sanitize(s);
        if(s.length===0) throw new Error("請輸入有效的數字");
        const vchk = validateDigits(s, base);
        if(!vchk.ok) throw new Error(vchk.msg);
        let acc = 0n, b = BigInt(base);
        for(let i=0;i<s.length;i++){
          const d = BigInt(charToVal.get(s[i]));
          acc = acc * b + d;
        }
        return acc * sign;
      }
      function bigIntToBase(n, base){
        if(!(base>=2 && base<=62)) throw new Error("基數必須介於 2 到 62");
        if(n===0n) return "0";
        let sign=""; if(n<0){ sign="-"; n = -n; }
        const b = BigInt(base);
        let out="";
        while(n>0n){
          const rem = Number(n % b);
          out = DIGITS[rem] + out;
          n = n / b;
        }
        return sign + out;
      }
      function render(){
        $alert.textContent = "";
        try {
          const fromBase = Number($from.value);
          const toBase = Number($to.value);
          const big = parseToBigInt($val.value, fromBase);
          const out = bigIntToBase(big, toBase);
          $out.textContent = out;
        } catch(e){
          $out.textContent = "—";
          $alert.textContent = e.message || String(e);
        }
      }
      ["input","change","keyup"].forEach(ev=>{
        $val.addEventListener(ev, render);
        $from.addEventListener(ev, render);
        $to.addEventListener(ev, render);
      });
      render();
    })();
  </script>
</body>
</html>
